var appConfig=document.querySelector&&document.querySelector("#appconfig"),url_gtm=appConfig&&appConfig.dataset.taxonomyapi||"https://click.my11circle.com/trackdata";console.log(">>>>> url_gtm",url_gtm);var loginfo1=!1;function gtmAnalyticsHelper(){var e="analytics-clicktracking",t=null,n={},a=null,o=!1,i=0,r={},l=null,c=!1,s=null,d=null,u=!1,f=function(){this.add=function(e,t,n){i>1e3&&(console.log("Analytics storage full, flushing old data"),this.flushOldData()),window.localStorage.setItem(e,JSON.stringify({trackingKey:e,data:t,count:n})),i++}.bind(this),this.delete=function(e){window.localStorage.removeItem(e)},this.update=function(e,t,n){this.add(e,t,n)}.bind(this),this.get=function(e){var t=window.localStorage.getItem(e);if(t)try{t=JSON.parse(t)}catch(e){}return t},this.flushOldData=function(){var e=this.getAllData();e.sort(function(e,t){return e.count>t.count?-1:e.count==t.count?0:1});for(var t=Math.ceil(.2*e.length),n=0;n<t;n++){var a=e[n]&&e[n].trackingKey;this.delete(a)}}.bind(this),this.getItemCount=function(){for(var e=0,t=0;t<window.localStorage.length;t++)-1!==window.localStorage.key(t).indexOf("tagManager_queue_")&&e++;return e},this.getAllData=function(){for(var e=[],t=0;t<window.localStorage.length;t++)if(-1!==window.localStorage.key(t).indexOf("tagManager_queue_")){var n=localStorage.key(t),a=localStorage.getItem(n);try{e.push(JSON.parse(a))}catch(e){}}return e};var e=Object.keys(n);if(e.length)for(var t=0;t<e.length;t++){var a=e[t];n[a]&&n[a].data&&(this.add(a,n[a].data,0),delete n[a])}},g=function(r,l,c){if(!l||"object"!=typeof l||0===Object.keys(l).length)return c();var s=r||"tagManager_queue_"+Date.now()+"_"+Number(Math.random()).toFixed(2);if(o&&a)return a.add(s,l,0),c(s);if(t){i>1e3&&(console.log("Analytics storage full, flushing old data"),v());var d=t.transaction(e,"readwrite");d.oncomplete=function(){c(s)},d.onerror=function(){c()},d.objectStore(e).add({trackingKey:s,data:l,count:0}).onsuccess=function(e){i++}}else n[s]={trackingKey:s,data:l,count:0}},m=function(n){if(o){var i=a.get(n);if(i){n=i.trackingKey;var r=Number(i.count)+1;r>9999?a.delete(n):a.add(n,i.data,r)}}else{var l=t.transaction(e,"readwrite").objectStore(e);l.get(n).onsuccess=function(e){var t=e.target.result;t&&((t.count=Number(t.count)+1)>9999?h(n,l):p(n,l,t))}}},p=function(e,t,a){n[e]&&(n[e]=a);var o=t.put(a);o.onsuccess=function(e){},o.onerror=function(t){console.warn("Data update failed!",{key:e})}},h=function(a,o){delete n[a],o||(o=t.transaction(e,"readwrite").objectStore(e));var r=o.delete(a);r.onsuccess=function(e){i--},r.onerror=function(e){console.warn("Delete data failure",a)}},v=function(){o?a.flushOldData():w(function(e){e.sort(function(e,t){return e.count>t.count?-1:e.count==t.count?0:1});for(var t=Math.ceil(.2*e.length),n=0;n<t;n++){var a=e[n]&&e[n].trackingKey;h(a)}})},w=function(n){if(o){var i=a.getAllData();return n(i)}t.transaction(e).objectStore(e).getAll().onsuccess=function(e){var t=e.target.result;t&&Array.isArray(t)&&t.length>0?n(t):n([])}},y=function(n){if(o){var i=a.getItemCount();return n(i)}var r=t.transaction(e).objectStore(e).count();r.onsuccess=function(){n(r.result)}},b=function(e,t){return r[e]=t,Object.keys(r).length},x=function(e){var t=document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return t?t.pop():""},k=function(){w(function(e){if(!o&&!a)for(var t=(new f).getAllData(),n=0;n<t.length;n++){var i=(l=t[n]).trackingKey,r=l.data;b(i,r)}for(n=0;n<e.length;n++){var l;i=(l=e[n]).trackingKey,r=l.data;b(i,r)}j()})},j=function(){if(!c){c=!0;var e=Object.keys(r);e=e.splice(0,1),s=e[e.length-1];for(var t=[],n=0;n<e.length;n++){var a=e[n];t.push(r[a]),m(a),delete r[a]}t.length>0?function(e,t,n,a){var o=new XMLHttpRequest;if(o.open("POST",url_gtm,!0),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o.withCredentials=!0,o.timeout=4e3,t&&"object"==typeof t)try{t=JSON.stringify(t)}catch(e){return}o.send(t),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)n&&n(e);else if(a)try{a(e)}catch(e){}}}(e,{batchEvents:t},T,S):(c=!1,M())}},I=function(e){clearTimeout(l),l=setTimeout(j,e||300)},M=function(e){clearTimeout(l),l=setTimeout(k,e||300)},T=function(e){c=!1;for(var t=0;t<e.length;t++){var n=e[t];o?a.delete(n):h(n)}d=e[e.length-1],y(function(e){(i=e)>0&&d==s&&(Object.keys(r).length>0?I():M())})},S=function(e){c=!1,Object.keys(r).length>0?I(2e4):M(2e4)};this.push=function(e){if("undefined"!=typeof trackingGlobal&&(e.globalTrackingInfo=trackingGlobal.get()),u)try{return void Android.sendEvent(JSON.stringify(e))}catch(e){console.warn("Android push error",e)}var t=function(e){if(e.ajaxResponse&&"object"==typeof e.ajaxResponse)try{e.ajaxResponse=JSON.stringify(e.ajaxResponse)}catch(t){e.ajaxResponse=(new XMLSerializer).serializeToString(e.ajaxResponse)}e.ajaxResponse&&"string"==typeof e.ajaxResponse&&e.ajaxResponse.length>200&&(e.ajaxResponse=e.ajaxResponse.substring(0,200)),e.selectedItem&&"string"==typeof e.selectedItem&&e.selectedItem.length>200&&(e.selectedItem=e.selectedItem.substring(0,200));var t=x("NA_IDVISIT"),n=x("NA_VISITOR");return{event:e.event,url:e.fullUrl,timestamp:e.timestamp,id:e.id,metadata:e.metadata,metadata_extra:e.metadata_extra,selectedItem:e.selectedItem,className:e.className,ajaxUrl:e.ajaxUrl,ajaxData:e.ajaxData,ajaxResponse:e.ajaxResponse,formData:e.formData,globalTrackingInfo:e.globalTrackingInfo,NA_IDVISIT:t||"",NA_VISITOR:n||""}}(e);g(null,t,function(e){b(e,t),j()})},window.Android&&Android.sendEvent&&(u=!0),function(r){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction||{READ_WRITE:"readwrite"},window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,!window.indexedDB)return o=!0,a=new f,void(r&&r());var l=window.indexedDB.open(e,1);l.onerror=function(e){console.error(e),o=!0,a=new f,r&&r()},l.onsuccess=function(e){t=l.result;var a=Object.keys(n);if(a.length)for(var o=0;o<a.length;o++){var c=a[o];n[c]&&n[c].data&&(g(c,n[c].data,function(){}),delete n[c])}y(function(e){i=e,r&&r()}),console.log("DB is now open")},l.onupgradeneeded=function(t){var n=t.target.result;n.onerror=function(e){console.error(e),o=!0,a=new f,r&&r()};var i=n.createObjectStore(e,{keyPath:"trackingKey"});i.createIndex("data","data",{unique:!1}),i.createIndex("count","count",{unique:!1})}}(function(){k()})}function createXMLHttp(){if(void 0!==typeof XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)for(var e=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}function clickEventTracking(e,t,n,a,o,i,r,l,c,s,d,u,f,g){if(infologGTM("Track "+e+" id="+a+" selectedItem="+o+" timestamp "+n),c&&"object"==typeof c)try{c=JSON.stringify(c)}catch(e){c=(new XMLSerializer).serializeToString(c)}c&&"string"==typeof c&&c.length>200&&(c=c.substring(0,200)),o&&"string"==typeof o&&o.length>200&&(o=o.substring(0,200)),data={event:e&&void 0!==e?e:null,url:t&&void 0!==t?t:null,timestamp:n&&void 0!==n?n:Date.now(),id:a&&void 0!==a?a:null,selectedItem:o&&void 0!==o?o:null,className:i&&void 0!==i?i:null,ajaxUrl:r&&void 0!==r?r:null,ajaxData:l&&void 0!==l?l:null,ajaxResponse:c&&void 0!==c?c:null,metadata:null,formData:s&&void 0!==s?s:null,globalTrackingInfo:d&&void 0!==d?d:null};var m,p=createXMLHttp();if(p.open("POST",url_gtm,!0),p.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),p.withCredentials=!0,p.timeout=2e3,data&&"object"==typeof data)try{m=JSON.stringify(data)}catch(e){return}p.send(m),p.onreadystatechange=function(){if(4===p.readyState)if(200===p.status)u&&u(f);else if(g)try{g(f)}catch(e){}}}function analyticsEvent(e){var t,n=createXMLHttp();if(n.open("POST",url_gtm,!0),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),e.selectedItem=null,e.ajaxUrl=null,e.ajaxData=null,e.ajaxResponse=null,e.formData=null,e&&"object"==typeof e)try{t=JSON.stringify(e)}catch(e){return}n.withCredentials=!0,n.send(t),n.onreadystatechange=function(){4===n.readyState&&n.status}}if(tagManagerQue=new gtmAnalyticsHelper,!window.clickTrackingLoad){console.log("Track in gtm-temp"),window.addEventListener?(window.addEventListener("beforeunload",beforeunloadEvent,!1),window.addEventListener("click",clickEventHandling,!1),window.addEventListener("submit",submitEvent,!1),window.addEventListener("change",changeEvent,!1),window.addEventListener("unload",unloadEvent,!1),window.addEventListener("load",loadEvent,!1)):window.attachEvent&&(window.attachEvent("onbeforeunload",beforeunloadEvent),window.attachEvent("onclick",clickEventHandling),window.attachEvent("onsubmit",submitEvent),window.attachEvent("onchange",changeEvent),window.attachEvent("onunload",unloadEvent),window.attachEvent("onload",loadEvent));var gtmLoad=new gtm_load;window.clickTrackingLoad=!0}function trackThis(e,t,n,a){console.log("TRACKTHIS",e,t,n,a);var o={event:e,fullUrl:window.location.href,timestamp:Date.now(),id:t,selectedItem:t};n&&(o.metadata=n),a&&(o.metadata_extra=a),tagManagerQue.push(o)}function infologGTM(e){loginfo1&&("object"==typeof e?console.log(e):console.log("%cinfo11: "+e,"color:blue;"))}function clickEventHandling(e){try{var t=e.target,n=Date.now();infologGTM(e),infologGTM(t);var a=0;if(e&&t&&(null!=t.id||null!=t.className)){var o="",i="";if(null!=t.onclick||null!=t.href||"submit"==t.type||"button"==t.type||"IMG"==t.nodeName||""!==t.getAttribute("track-id")&&null!==t.getAttribute("track-id")){o=t.id?t.id:""!==t.getAttribute("track-id")&&null!==t.getAttribute("track-id")?t.getAttribute("track-id"):t.className,i=t.className||"",t.childNodes.length>0&&(t=t.childNodes[t.childNodes.length-1].childNodes.length>0?t.childNodes[t.childNodes.length-1]:t);var r=t.innerHTML;"IMG"==t.nodeName&&(r=t.src);var l={event:"gtm.click",fullUrl:window.location.href,timestamp:n,id:o,selectedItem:r.substring(0,200),className:i};tagManagerQue.push(l)}else for(var c=t;a<5;){if(null!=(c=c.parentNode).onclick||null!=c.href||"submit"==c.type){o=t.id?t.id:t.className,i=t.className||"";l={event:"gtm.click",fullUrl:window.location.href,timestamp:n,id:o,selectedItem:t.innerHTML,className:i};tagManagerQue.push(l);break}a++}if(a>=5){o=t.id?t.id:t.className,i=t.className||"";l={event:"gtm.click",fullUrl:window.location.href,timestamp:n,id:o,selectedItem:t.innerHTML,className:i};tagManagerQue.push(l)}}}catch(e){infologGTM(e)}}function beforeunloadEvent(e){var t={event:"event.beforeunload",fullUrl:window.location.href,timestamp:Date.now()};tagManagerQue.push(t)}function serializeArray(e){for(var t=[],n=0;n<e.elements.length;n++){var a=e.elements[n];if(a.name&&!a.disabled&&"password"!==a.type&&"file"!==a.type&&"reset"!==a.type&&"submit"!==a.type&&"button"!==a.type)if("select-multiple"===a.type)for(var o=0;o<a.options.length;o++)a.options[o].selected&&t.push({name:a.name,value:a.options[o].value});else("checkbox"!==a.type&&"radio"!==a.type||a.checked)&&t.push({name:a.name,value:a.value})}return t}function sanitizeSerializedForm(e){if(void 0!==e)try{return e.filter(function(e){switch(e.name){case"password":case"captcha_response":return console.log("[sanitizeSerializedForm] removed input element: "+e.name),!1}return!0})}catch(e){console.log("[sanitizeSerializedForm] exception",e)}}function submitEvent(e){try{var t=serializeArray(document.querySelector("form"));t=sanitizeSerializedForm(t);var n=JSON.stringify(t),a="";a=e.target.id?e.target.id:e.target.className;var o=e.target.className||"",i={event:"gtm.submit",fullUrl:window.location.href,timestamp:Date.now(),id:a,formData:n,className:o};tagManagerQue.push(i)}catch(e){infologGTM(e)}}function changeEvent(e){try{var t=e.target.id,n=document.getElementById(t),a=document.getElementById(t).tagName,o=document.getElementById(t).type,i=[],r=e.target.className||"";if("SELECT"==a||"checkbox"==o||"radio"==o){infologGTM(n),i="INPUT"==a&&"checkbox"==o?n.name:n.value;var l={event:"event.change",fullUrl:window.location.href,timestamp:Date.now(),id:t,selectedItem:i,className:r};tagManagerQue.push(l)}}catch(e){infologGTM(e)}}function loadEvent(e){var t={event:"gtm.load",fullUrl:window.location.href,timestamp:Date.now()};tagManagerQue.push(t)}function unloadEvent(e){var t={event:"gtm.unload",fullUrl:window.location.href,timestamp:Date.now()};tagManagerQue.push(t)}function gtm_load(){try{var e=new Object;e.tempOpen=XMLHttpRequest.prototype.open,e.tempSend=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.open=function(t,n){t||(t=""),n||(n=""),e.tempOpen.apply(this,arguments),e.method=t,e.url=n,"get"==t.toLowerCase()&&(e.data=n.split("?"),e.data=e.data[1]),this._url=n,this._data=e.data,this.addEventListener("load",function(){if(-1==this._url.indexOf("trackdata")&&-1==this._url.indexOf("getOnlineUsers")&&(infologGTM("Track: xml http listener called:"+this._url),!this._data||"string"!=typeof this._data||this._data.indexOf&&-1==this._data.indexOf("selectedItem")||this._data.indexOf&&-1==this._data.indexOf("ajaxResponse"))){var e=removeSensitiveParams(this._data),t=Date.now();try{var n={event:"event.ajax",fullUrl:window.location.href,timestamp:t,ajaxUrl:this._url,ajaxData:e,ajaxResponse:this.responseText}}catch(a){console.warn("Error",a);n={event:"event.ajax",fullUrl:window.location.href,timestamp:t,ajaxUrl:this._url,ajaxData:e}}tagManagerQue.push(n)}})},XMLHttpRequest.prototype.send=function(t,n){t||(t=""),e.tempSend.apply(this,arguments),"post"==e.method.toLowerCase()&&(e.data=t),this._data=e.data},"undefined"!=typeof jQuery&&($.ajaxPrefilter(function(e,t,n){e.global=!0}),$(document).ajaxSend(function(e,t,n){n.url.indexOf("tlist.do")>=0||n.url.indexOf("jsonp")<0||-1==n.url.indexOf("trackdata")&&t.done(function(e){var t=(new Date).getTime(),a={event:"event.ajax",fullUrl:window.location.href,timestamp:t,ajaxUrl:n.url,ajaxData:n.data,ajaxResponse:e};tagManagerQue.push(a)})}))}catch(e){infologGTM(e)}}function removeSensitiveParams(e){var t=["passwd","password","j_password","fake_j_password","cur_pwd","new_pwd","fusion_resp_pwd"];if(e){try{if("string"!=typeof e)for(var n=t.length-1;n>=0;n--)delete e[t[n]];else try{JSON.parse(e);var a=!1;for(n=t.length-1;n>=0;n--)-1!==e.indexOf(t[n])&&(a=!0);a&&(e="")}catch(a){for(n=t.length-1;n>=0;n--){var o=new RegExp("&"+t[n]+"(\\=[^&]*)?(?=&|$)|^"+t[n]+"(\\=[^&]*)?(&|$)");e=e.replace(o,"")}}}catch(e){console.warn("Unable to remove sensitiveParams from string",e)}return e}}!function(){window.trackThis=trackThis;try{var e=document.getElementById("metaPageName");if(e&&null!==e){e=e.getAttribute("value");var t=document.location.href;trackThis("gtm.lpab-pagename",t.substring(0,t.lastIndexOf("/")+1)+e+document.location.search)}else trackThis("gtm.lpab-pagename",document.location.href)}catch(e){trackThis("gtm.lpab-pagename",document.location.href)}}();